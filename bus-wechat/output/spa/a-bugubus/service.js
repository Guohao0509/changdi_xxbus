app.service("$myLocationService",function(){var el=document.createElement("div");el.id="map"+(new Date).getTime(),el.style="width:0;height:0",document.body.appendChild(el);var map,geolocation,geocoder;map=new AMap.Map(el.id,{resizeEnable:!0}),geocoder=new AMap.Geocoder({radius:1e3,city:"027",extensions:"all"}),this.getCurrentPosition=function(callback){map.plugin("AMap.Geolocation",function(){geolocation=new AMap.Geolocation({enableHighAccuracy:!0,convert:!0}),geolocation.getCurrentPosition(),AMap.event.addListener(geolocation,"complete",function(data){geocoder.getAddress(data.position,function(status,result){"complete"===status&&"OK"===result.info&&callback(result.regeocode.pois&&result.regeocode.pois.length>0?result.regeocode.pois:[])})}),AMap.event.addListener(geolocation,"error",function(){alert("您禁止了授权定位信息,若想继续操作请输入地址信息")})})},this.getPoisByLngLat=function(lngLat,callback){geocoder.getAddress(lngLat,function(status,result){"complete"===status&&"OK"===result.info&&callback(result.regeocode.pois&&result.regeocode.pois.length>0?result.regeocode.pois:[])})},this.AddressByKeyword=function(keyword){geocoder.getLocation(keyword,function(status,result){console.log(status),"complete"===status&&"OK"===result.info&&(console.log(result),result.geocodes.pois&&result.regeocode.pois.length>0)})},this.getPoisByKeyword=function(keyword,callback){AMap.service(["AMap.Autocomplete"],function(){var auto=new AMap.Autocomplete({city:"武汉",datatype:"all"});keyword.length>0&&auto.search(keyword,function(status,result){"complete"==status?callback(result.tips):"no_data"==status&&callback([])})})}}).service("$myHttpService",function($http,$ionicLoading,$state){this.post=function(url,data,success,error){$ionicLoading.show(),$http.post(url,data).success(function(data){if(window.setTimeout(function(){$ionicLoading.hide()},250),0==data.code){if(0==data.data.flag)return void $state.go("auth.login",{},{location:"replace"});success(data.data)}else{var errorMsg="";errorMsg=data.data.msg?data.data.msg:data.data,layer?layer.alert(errorMsg):alert(errorMsg),error&&error(data.data)}}).error(function(e){$ionicLoading.hide(),layer?layer.alert(e.message):alert(e.message),error&&error(e)})},this.postNoLoad=function(url,data,success,error){$http.post(url,data).success(function(data){if(0==data.code)success(data.data);else{var errorMsg="";errorMsg=data.data.msg?data.data.msg:data.data,layer?layer.alert(errorMsg):alert(errorMsg),error&&error(data.data)}}).error(function(e){layer?layer.alert(e.message):alert(e.message),error&&error(e)})},this.get=function(url,data,success,error){$ionicLoading.show(),$http.get(url,data).success(function(data){if($ionicLoading.hide(),0==data.code)success(data.data);else{var errorMsg="";errorMsg=data.data.msg?data.data.msg:data.data,layer?layer.alert(errorMsg):alert(errorMsg),error&&error(data.data)}}).error(function(e){$ionicLoading.hide(),layer?layer.alert(e.message):alert(e.message),error&&error(e)})}}).service("$selectCity",function(){this.getCity=function(callback){var citysearch=new AMap.CitySearch;citysearch.getLocalCity(function(status,result){"complete"===status&&"OK"===result.info&&callback(result&&result.city?result.city:[])})}});