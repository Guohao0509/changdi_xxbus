angular.module("ion-datetime-picker",["ionic"]).directive("ionDatetimePicker",function(){return{restrict:"AE",require:"ngModel",scope:{modelDate:"=ngModel",title:"=?",subTitle:"=?",buttonOk:"=?",buttonCancel:"=?",monthStep:"=?",hourStep:"=?",minuteStep:"=?",secondStep:"=?",onlyValid:"=?"},controller:function(e,t,n,a){function i(e,t){0!==(t=t||0)&&e.setDate(e.getDate()+t),r.year=e.getFullYear(),r.month=e.getMonth(),r.day=e.getDate(),r.hour=e.getHours(),r.minute=e.getMinutes(),r.second=e.getSeconds(),r.date=e}function o(){var t=new Date(e.year,e.month,e.day,e.hour,e.minute,e.second);e.isEnabled(t.getDate(),!0)?i(t):(e.year=r.year,e.month=r.month,e.day=r.day,e.hour=r.hour,e.minute=r.minute,e.second=r.second)}function d(e){var t=new Date(e);return isNaN(t.getTime())&&(t=new Date),t.setHours(0,0,0,0,0),t}e.i18n=n,e.bind={},e.rows=[0,1,2,3,4,5],e.cols=[1,2,3,4,5,6,7],e.weekdays=[0,1,2,3,4,5,6];var r={year:e.year,month:e.month,day:e.day,hour:e.hour,minute:e.minute,second:e.second,date:new Date,getDateWithoutTime:function(){var e=new Date(this.date);return e.setHours(0,0,0,0,0),e}};e.showPopup=function(){t.show({templateUrl:"lib/ion-datetime-picker/src/picker-popup.html",title:e.title||"ѡ�� "+(e.dateEnabled?"����":"")+(e.dateEnabled&&e.timeEnabled?" �� ":"")+(e.timeEnabled?"ʱ��":""),subTitle:e.subTitle||"",scope:e,cssClass:"ion-datetime-picker-popup",buttons:[{text:e.buttonOk||e.i18n.ok,type:e.i18n.okClass,onTap:function(){e.commit()}},{text:e.buttonCancel||e.i18n.cancel,type:e.i18n.cancelClass,onTap:function(){a(function(){e.processModel()},200)}}]})},e.prepare=function(){e.mondayFirst&&e.weekdays.push(e.weekdays.shift())},e.processModel=function(){var t=e.modelDate instanceof Date?e.modelDate:new Date;e.year=e.dateEnabled?t.getFullYear():0,e.month=e.dateEnabled?t.getMonth():0,e.day=e.dateEnabled?t.getDate():0,e.hour=e.timeEnabled?t.getHours():0,e.minute=e.timeEnabled?t.getMinutes():0,e.second=e.secondsEnabled?t.getSeconds():0,l()};var l=function(){o();var t=new Date(e.year,e.month,e.day,e.hour,e.minute,e.second);e.dateEnabled&&(e.year=t.getFullYear(),e.month=t.getMonth(),e.day=t.getDate(),e.bind.year=e.year,e.bind.month=e.month,e.firstDay=new Date(e.year,e.month,1).getDay(),e.mondayFirst&&(e.firstDay=(e.firstDay||7)-1),e.daysInMonth=u(e.year,e.month)),e.timeEnabled&&(e.hour=t.getHours(),e.minute=t.getMinutes(),e.second=t.getSeconds(),e.meridiem=(e.hour,"����"),e.bind.hour=e.meridiemEnabled?(e.hour%12||12).toString():e.hour.toString(),e.bind.minute=(e.minute<10?"0":"")+e.minute.toString(),e.bind.second=(e.second<10?"0":"")+e.second.toString(),e.bind.meridiem=e.meridiem)},u=function(e,t){return new Date(e,t+1,0).getDate()};e.changeBy=function(t,n){if(+t){if(("hour"===n||"minute"===n)&&-1===t){var a=new Date(e.year,e.month,e.day,e.hour-1,e.minute);0!==e.minute&&"hour"!==n||e.hour!==a.getHours()||e.hour--}e[n]+=+t,"month"!==n&&"year"!==n||(e.day=Math.min(e.day,u(e.year,e.month))),l()}},e.change=function(t){var n=e.bind[t];n&&"meridiem"===t?("AM"===(n=n.toUpperCase())&&"PM"===e.meridiem?e.hour-=12:"PM"===n&&"AM"===e.meridiem&&(e.hour+=12),l()):(+n||0==+n)&&(e[t]=+n,"month"!==t&&"year"!==t||(e.day=Math.min(e.day,u(e.year,e.month))),l())},e.changeDay=function(t){e.day=t,l()},e.isEnabled=function(t,n){if(!e.onlyValid)return!0;var a=new Date(e.year,e.month,t),o=!0;if(e.onlyValid.after){var l=d(e.onlyValid.after);e.onlyValid.inclusive?!(o=a>=l)&&n&&i(l,0):!(o=a>l)&&n&&i(l,1)}else if(e.onlyValid.before){var u=d(e.onlyValid.after);e.onlyValid.inclusive?!(o=a<=u)&&n&&i(u,0):!(o=a<u)&&n&&i(u,-1)}else if(e.onlyValid.between){var m=d(e.onlyValid.between.initial),s=d(e.onlyValid.between.final);e.onlyValid.inclusive?!(o=a>=m&&a<=s)&&n&&(a<m&&i(m,0),a>s&&i(s,0)):!(o=a>m&&a<s)&&n&&(a<=m&&i(m,1),a>=s&&i(s,-1))}else if(e.onlyValid.outside){var m=d(e.onlyValid.outside.initial),s=d(e.onlyValid.outside.final);if(e.onlyValid.inclusive)!(o=a<=m||a>=s)&&n&&((c=r.getDateWithoutTime())<=m&&i(s,0),c>=s&&i(m,0));else if(!(o=a<m||a>s)&&n){var c=r.getDateWithoutTime();c<m&&i(s,1),c>s&&i(m,-1)}}return o},e.changed=function(){l()},e.dateEnabled&&e.$watch(function(){return(new Date).getDate()},function(){var t=new Date;e.today={day:t.getDate(),month:t.getMonth(),year:t.getFullYear()}})},link:function(e,t,n,a){e.title="title"in n&&n.title,e.dateEnabled="date"in n&&"false"!==n.date,e.timeEnabled="time"in n&&"false"!==n.time,!1===e.dateEnabled&&!1===e.timeEnabled&&(e.dateEnabled=e.timeEnabled=!0),e.mondayFirst="mondayFirst"in n&&"false"!==n.mondayFirst,e.secondsEnabled=e.timeEnabled&&"seconds"in n&&"false"!==n.seconds,e.meridiemEnabled=e.timeEnabled&&"amPm"in n&&"false"!==n.amPm,e.monthStep=+e.monthStep||1,e.hourStep=+e.hourStep||1,e.minuteStep=+e.minuteStep||1,e.secondStep=+e.secondStep||1,e.prepare(),a.$render=function(){e.modelDate=a.$viewValue,e.processModel()},e.commit=function(){e.modelDate=new Date(e.year,e.month,e.day,e.hour,e.minute,e.second),a.$setViewValue(e.modelDate)},t.on("click",e.showPopup)}}});