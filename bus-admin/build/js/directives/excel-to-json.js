angular.module("app.directives").directive("excelToJson",[function(){return{restrict:"A",replace:!0,scope:{sendJson:"&"},templateUrl:"../../tpl/blocks/excel-to-json.html",controller:function($scope){},link:function(scope,element,attrs){function importf(obj){if(obj.files){var f=obj.files[0],reader=new FileReader;reader.readAsArrayBuffer(f),reader.onload=function(e){var data=e.target.result,wb=XLSX.read(btoa(fixdata(data)),{type:"base64"}),json=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);scope.sendJson({data:json})}}}function fixdata(data){for(var o="",l=0,w=10240;l<data.byteLength/w;++l)o+=String.fromCharCode.apply(null,new Uint8Array(data.slice(l*w,l*w+w)));return o+=String.fromCharCode.apply(null,new Uint8Array(data.slice(l*w)))}document.getElementById("excel_upload").onchange=function(e){importf(e.target)}}}}]);